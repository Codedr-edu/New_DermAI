<!doctype html>
<html lang="vi">
<head>
    <meta property="og:title" content="DermAI - Ứng dụng AI hỗ trợ chẩn đoán bệnh da liễu">
    <meta property="og:description" content="Ứng dụng AI hỗ trợ chẩn đoán các bệnh về da liễu nhanh chóng và chính xác. Sử dụng trí tuệ nhân tạo và thị giác máy tính để phân tích hình ảnh da và cung cấp các chẩn đoán kịp thời.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://litclub.pythonanywhere.com/">
    <meta property="og:image" content="https://scontent.fhan15-2.fna.fbcdn.net/v/t39.30808-6/517737809_122100053498943826_3327007350081078447_n.png?_nc_cat=107&ccb=1-7&_nc_sid=cc71e4&_nc_ohc=edONUK9z7kkQ7kNvwGrcQv7&_nc_oc=AdkRdS-VL0_JPfxBJv-XMhR_XPRw6BcxfGIvM441XgvNj4YQEuV7E0WNzscIUV9WT8I&_nc_zt=23&_nc_ht=scontent.fhan15-2.fna&_nc_gid=oQXmcf39N5CEF7QDQIN0hw&oh=00_AfTGO5IfzsEbxFCqddWx-S-7SJlJnywSnTXyjgdq0DteCQ&oe=68801A5D">
    <meta property="og:site_name" content="DermAI - Ứng dụng AI hỗ trợ chẩn đoán bệnh da liễu">

    <link rel="shortcut icon" href="https://github.com/Codedr-edu/DermAI/blob/main/media/Thi%E1%BA%BFt%20k%E1%BA%BF%20ch%C6%B0a%20c%C3%B3%20t%C3%AAn.png?raw=true" type="image/x-icon">

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chatbot - DermAI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Reuse visual language from home.html */
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e8f0ff 100%);
        }
        .card-chat {
            width: 380px;
            max-width: 92vw;
            border: 0;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            /* let the card grow but not exceed viewport; keeps it centered and usable on mobile */
            height: min(86vh, 760px);
            margin: 12px auto;
        }

        /* Desktop: make the chat wider for better balance */
        @media (min-width: 1000px) {
            .card-chat {
                width: 720px;
                max-width: 80vw;
                height: min(80vh, 860px);
            }
        }
        .chat-header {
            padding: 16px;
            background: linear-gradient(90deg,#fff,#f7fbff);
            border-bottom: 1px solid rgba(0,0,0,0.04);
            display:flex;
            align-items:center;
            gap:12px;
        }
        .brand { font-weight:700; letter-spacing:-0.02em; }
        .chat-body {
            /* flexible middle area: will take remaining card height */
            flex: 1 1 auto;
            min-height: 0; /* allow flex child to shrink correctly and enable scrolling */
            overflow-y: auto;
            padding: 16px;
            background: #fff;
            display:flex;
            flex-direction:column;
            gap:10px;
        }
        .bubble {
            max-width: 78%;
            padding: 10px 14px;
            border-radius: 14px;
            font-size: 0.95rem;
            line-height: 1.3;
            box-shadow: 0 6px 18px rgba(13,110,253,0.04);
        }
        .bubble.user {
            margin-left: auto;
            background: #0d6efd;
            color: #fff;
            border-bottom-right-radius: 4px;
        }
        .bubble.bot {
            margin-right: auto;
            background: #f1f5fb;
            color: #0b1a36;
            border-bottom-left-radius: 4px;
        }
        .chat-input-row {
            padding: 12px;
            background: #ffffff;
            display:flex;
            gap:8px;
            align-items:center;
            border-top: 1px solid rgba(0,0,0,0.04);
            flex-shrink: 0; /* keep input row visible at bottom of card */
        }
        /* Reserve space so fixed bottom navbar doesn't cover the card input on small screens */
        body {
            padding-bottom: 76px;
        }
        .chip {
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:6px 12px;
            border-radius:999px;
            background: linear-gradient(180deg,#f7fbff,#eef6ff);
            color:#0d6efd;
            font-size:0.85rem;
            box-shadow: inset 0 -1px 0 rgba(13,110,253,0.03);
            border: 1px solid rgba(13,110,253,0.06);
        }

        /* ensure header content doesn't wrap awkwardly on wide layouts */
        .chat-header > div { min-width: 0; }
    </style>
</head>
<body class="d-flex vh-100">
    <div class="container d-flex align-items-center justify-content-center" style="min-height:100%;">
        <div class="card card-chat bg-white">
            <div class="chat-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#0d6efd" class="me-2" viewBox="0 0 16 16">
                    <path d="M10.5 2a1 1 0 0 0-.832.445L8.94 4H7.06L6.332 2.445A1 1 0 0 0 5.5 2h-3A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h11A1.5 1.5 0 0 0 15 12.5v-9A1.5 1.5 0 0 0 13.5 2h-3zM8 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                </svg>
                <div>
                    <div class="brand">DermAI Chat</div>
                    <div class="hint" style="font-size:0.85rem;color:#6b7280;">Hỏi bác sĩ ảo powered by Gemini</div>
                </div>
                <div class="ms-auto d-flex align-items-center">
                    <span class="chip" aria-hidden="true">Model: <strong style="margin-left:6px;color:#0d6efd;">Gemini</strong></span>
                </div>
            </div>

            <div id="chatBody" class="chat-body">
                <!-- messages will be appended here -->
            </div>

            <div class="chat-input-row">
                <input id="messageInput" type="text" class="form-control" placeholder="Nhập câu hỏi của bạn..." aria-label="Nhập câu hỏi" style="flex:1 1 auto;border-top-left-radius:12px;border-bottom-left-radius:12px;"/>
                <button id="sendBtn" class="btn btn-primary d-flex align-items-center justify-content-center" title="Gửi" aria-label="Gửi" style="width:48px;height:44px;border-top-right-radius:12px;border-bottom-right-radius:12px;padding:0;">
                    <!-- paper plane icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <style>
        /* if viewport height is very small, align card to top with a little margin so input stays visible */
        @media (max-height: 520px) {
            .container.d-flex {
                align-items: flex-start !important;
                padding-top: 12px;
            }
        }
    </style>

    <!-- bottom navbar copied from home.html -->
    <nav class="navbar navbar-light bg-white border-top fixed-bottom">
      <div class="container d-flex justify-content-around py-2">
        <a href="/" class="d-flex flex-column align-items-center text-decoration-none text-muted" aria-current="page">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-fill" viewBox="0 0 16 16">
            <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
            <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0"/>
          </svg>
        </a>

        <!--<a href="/community" class="d-flex flex-column align-items-center text-decoration-none text-muted">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-square-quote-fill" viewBox="0 0 16 16">
            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.5a1 1 0 0 0-.8.4l-1.9 2.533a1 1 0 0 1-1.6 0L5.3 12.4a1 1 0 0 0-.8-.4H2a2 2 0 0 1-2-2zm7.194 2.766a1.7 1.7 0 0 0-.227-.272 1.5 1.5 0 0 0-.469-.324l-.008-.004A1.8 1.8 0 0 0 5.734 4C4.776 4 4 4.746 4 5.667c0 .92.776 1.666 1.734 1.666.343 0 .662-.095.931-.26-.137.389-.39.804-.81 1.22a.405.405 0 0 0 .011.59c.173.16.447.155.614-.01 1.334-1.329 1.37-2.758.941-3.706a2.5 2.5 0 0 0-.227-.4zM11 7.073c-.136.389-.39.804-.81 1.22a.405.405 0 0 0 .012.59c.172.16.446.155.613-.01 1.334-1.329 1.37-2.758.942-3.706a2.5 2.5 0 0 0-.228-.4 1.7 1.7 0 0 0-.227-.273 1.5 1.5 0 0 0-.469-.324l-.008-.004A1.8 1.8 0 0 0 10.07 4c-.957 0-1.734.746-1.734 1.667 0 .92.777 1.666 1.734 1.666.343 0 .662-.095.931-.26"/>
          </svg>
        </a>-->

        <a href="/chatbot" class="d-flex flex-column align-items-center text-decoration-none text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="mb-1" viewBox="0 0 16 16">
            <path d="M2 2h12v9H5.414L3 13.414V2z"/>
          </svg>
        </a>

        <a href="/pharmacy" class="d-flex flex-column align-items-center text-decoration-none text-muted">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-capsule-pill" viewBox="0 0 16 16">
            <path d="M11.02 5.364a3 3 0 0 0-4.242-4.243L1.121 6.778a3 3 0 1 0 4.243 4.243l5.657-5.657Zm-6.413-.657 2.878-2.879a2 2 0 1 1 2.829 2.829L7.435 7.536zM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8m-.5 1.042a3 3 0 0 0 0 5.917zm1 5.917a3 3 0 0 0 0-5.917z"/>
          </svg>
        </a>

        <a href="tel:115" class="d-flex flex-column align-items-center text-decoration-none text-danger">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="mb-1" viewBox="0 0 16 16">
            <path d="M3.654 1.328a.678.678 0 00-1.015-.063L1.605 2.298c-.483.48-.661 1.18-.45 1.803.35 1.098 1.07 2.78 2.65 4.36 1.58 1.58 3.262 2.3 4.36 2.65.623.211 1.323.033 1.803-.45l1.033-1.033a.678.678 0 00-.063-1.015l-2.07-1.552a.678.678 0 00-.58-.087l-1.52.507a.678.678 0 01-.657-.148L6.9 6.1a.678.678 0 00-.148-.657L6.255 4.9a.678.678 0 00-.087-.58L4.616 2.25z"/>
          </svg>
          <!--<small class="d-block">Gọi cấp cứu</small>-->
        </a>

        <a href="/profile" class="d-flex flex-column align-items-center text-decoration-none text-muted">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
          </svg>
        </a>
      </div>
    </nav>

    <script>
        // simple client that posts user messages to a Django endpoint and displays responses
        const chatBody = document.getElementById('chatBody');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');

        function appendBubble(text, who){
            const el = document.createElement('div');
            el.className = 'bubble ' + (who === 'user' ? 'user' : 'bot');
            el.textContent = text;
            chatBody.appendChild(el);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        async function sendMessage(){
            const text = messageInput.value.trim();
            if(!text) return;
            appendBubble(text, 'user');
            messageInput.value = '';
            appendBubble('Đang gửi...', 'bot');
            // POST to Django backend
            try{
                const resp = await fetch('/chatbot/api/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': (function(){
                            const name = 'csrftoken=';
                            const cookies = document.cookie.split(';');
                            for(const c of cookies){
                                const t = c.trim();
                                if(t.startsWith(name)) return t.substring(name.length);
                            }
                            return '';
                        })()
                    },
                    body: JSON.stringify({ message: text })
                });
                const data = await resp.json();
                // remove the 'Đang gửi...' placeholder (last bot bubble)
                const lastBot = [...chatBody.querySelectorAll('.bubble.bot')].pop();
                if(lastBot && lastBot.textContent === 'Đang gửi...') lastBot.remove();
                if(resp.ok && data){
                    // prefer sanitized HTML returned by server
                    if(data.reply_html){
                        const el = document.createElement('div');
                        el.className = 'bubble bot';
                        el.innerHTML = data.reply_html; // server-sanitized
                        chatBody.appendChild(el);
                        chatBody.scrollTop = chatBody.scrollHeight;
                    } else if(data.reply){
                        appendBubble(data.reply, 'bot');
                    } else {
                        appendBubble('Lỗi: Không nhận được phản hồi từ server.', 'bot');
                    }
                } else {
                    appendBubble('Lỗi: Không nhận được phản hồi từ server.', 'bot');
                }
            } catch (e){
                const lastBot = [...chatBody.querySelectorAll('.bubble.bot')].pop();
                if(lastBot && lastBot.textContent === 'Đang gửi...') lastBot.remove();
                appendBubble('Lỗi kết nối: ' + (e.message || e), 'bot');
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ e.preventDefault(); sendMessage(); } });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
