<!doctype html>
{% load i18n %}
<html lang="vi">

<head>
    <meta property="og:title" content="DermAI - ·ª®ng d·ª•ng AI h·ªó tr·ª£ ch·∫©n ƒëo√°n b·ªánh da li·ªÖu">
    <meta property="og:description"
        content="·ª®ng d·ª•ng AI h·ªó tr·ª£ ch·∫©n ƒëo√°n c√°c b·ªánh v·ªÅ da li·ªÖu nhanh ch√≥ng v√† ch√≠nh x√°c. S·ª≠ d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o v√† th·ªã gi√°c m√°y t√≠nh ƒë·ªÉ ph√¢n t√≠ch h√¨nh ·∫£nh da v√† cung c·∫•p c√°c ch·∫©n ƒëo√°n k·ªãp th·ªùi.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://litclub.pythonanywhere.com/">
    <meta property="og:image"
        content="https://scontent.fhan15-2.fna.fbcdn.net/v/t39.30808-6/517737809_122100053498943826_3327007350081078447_n.png?_nc_cat=107&ccb=1-7&_nc_sid=cc71e4&_nc_ohc=edONUK9z7kkQ7kNvwGrcQv7&_nc_oc=AdkRdS-VL0_JPfxBJv-XMhR_XPRw6BcxfGIvM441XgvNj4YQEuV7E0WNzscIUV9WT8I&_nc_zt=23&_nc_ht=scontent.fhan15-2.fna&_nc_gid=oQXmcf39N5CEF7QDQIN0hw&oh=00_AfTGO5IfzsEbxFCqddWx-S-7SJlJnywSnTXyjgdq0DteCQ&oe=68801A5D">
    <meta property="og:site_name" content="DermAI - ·ª®ng d·ª•ng AI h·ªó tr·ª£ ch·∫©n ƒëo√°n b·ªánh da li·ªÖu">

    <link rel="shortcut icon"
        href="https://github.com/Codedr-edu/DermAI/blob/main/media/Thi%E1%BA%BFt%20k%E1%BA%BF%20ch%C6%B0a%20c%C3%B3%20t%C3%AAn.png?raw=true"
        type="image/x-icon">

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{% trans 'C∆° s·ªü y t·∫ø g·∫ßn t√¥i' %} - DermAI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e8f0ff 100%);
        }

        .map-card {
            max-width: 980px;
            margin: 18px auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
            background: #fff;
            margin-bottom: 20vh;
        }

        #map {
            height: 60vh;
            min-height: 360px;
            margin-bottom: 10px;
        }

        .search-row {
            padding: 12px;
        }

        .pharmacy-list {
            max-height: 30vh;
            overflow: auto;
        }

        .pharmacy-item {
            cursor: pointer;
        }

        .brand {
            font-weight: 700;
        }

        .hint {
            font-size: 0.9rem;
            color: #6b7280;
        }

        /* reuse bottom navbar styling similar to home.html */
        nav.navbar {
            box-shadow: 0 -1px 0 rgba(0, 0, 0, 0.05);
        }
    </style>
</head>

<body class="d-flex flex-column align-items-center vh-100"
    data-auth="{{ request.user.is_authenticated|yesno:'true,false' }}">
    <div class="container vh-100">
        <div class="d-flex align-items-center justify-content-between py-3 flex-wrap gap-2">
            <div class="d-flex align-items-center flex-shrink-1" style="min-width: 0;">
                <div class="brand fs-4 me-3">DermAI</div>
                <div class="hint text-muted d-none d-md-block" id="mainHint">{% trans "T√¨m nh√† thu·ªëc g·∫ßn v·ªã tr√≠ c·ªßa b·∫°n" %}</div>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div class="text-end text-muted small d-none d-lg-block">{% trans 'B·∫£n ƒë·ªì powered by OpenStreetMap' %}
                </div>
                <div class="dropdown">
                    <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="languageDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false" style="min-width: 60px;">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'vi' %}üáªüá≥{% else %}üá¨üáß{% endif %}
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                        <li><a class="dropdown-item" href="#" onclick="switchLanguage('vi'); return false;">üáªüá≥ Ti·∫øng
                                Vi·ªát</a></li>
                        <li><a class="dropdown-item" href="#" onclick="switchLanguage('en'); return false;">üá¨üáß
                                English</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="map-card" style="margin-bottom: 20vh;">
            <div class="search-row d-flex gap-2 align-items-center border-bottom">
                <div class="flex-fill d-flex gap-2">
                    <input id="locationSearch" class="form-control"
                        placeholder="{% trans 'Nh·∫≠p ƒë·ªãa ch·ªâ/th√†nh ph·ªë n·∫øu GPS kh√¥ng ho·∫°t ƒë·ªông' %}" />
                    <button id="searchBtn" class="btn btn-outline-primary">{% trans 'T√¨m' %}</button>
                </div>
                <div>
                    <select id="typeSelect" class="form-select" style="min-width: 120px;">
                        <option value="pharmacy" selected>{% trans 'Nh√† thu·ªëc' %}</option>
                        <option value="hospital">{% trans 'B·ªánh vi·ªán' %}</option>
                        <option value="clinic">{% trans 'Ph√≤ng kh√°m' %}</option>
                    </select>
                </div>
                <div>
                    <select id="radiusSelect" class="form-select">
                        <option value="1000">1 km</option>
                        <option value="2000">2 km</option>
                        <option value="5000" selected>5 km</option>
                        <option value="10000">10 km</option>
                    </select>
                </div>
            </div>

            <div id="map"></div>

            <div class="p-3">
                <div class="row gx-3 gy-3">
                    <!-- On small screens, list comes first and spans full width. On md+ screens, list uses remaining space and hints sit to the right. -->
                    <div class="col-12 col-md-8 order-1 order-md-1">
                        <h6 id="listTitle">{% trans 'Nh√† thu·ªëc g·∫ßn ƒë√¢y' %}</h6>
                        <div id="list" class="pharmacy-list list-group"></div>
                    </div>
                    <div class="col-12 col-md-4 order-2 order-md-2">
                        <div class="small text-muted">{% trans 'G·ª£i √Ω' %}</div>
                        <div class="bg-light p-2 rounded">
                            <ul class="mb-0">
                                <li>{% trans 'Cho ph√©p truy c·∫≠p v·ªã tr√≠ khi ƒë∆∞·ª£c h·ªèi ƒë·ªÉ t√¨m nhanh nh·∫•t.' %}</li>
                                <li>{% trans 'N·∫øu kh√¥ng cho ph√©p, h√£y nh·∫≠p ƒë·ªãa ch·ªâ ho·∫∑c t√™n qu·∫≠n / th√†nh ph·ªë v√† nh·∫•n "T√¨m".' %}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div style="margin-bottom: 10vh;"></div>

    <!-- bottom navbar copied from home.html to preserve style -->
    <nav class="navbar navbar-light bg-white border-top fixed-bottom">
        <div class="container d-flex justify-content-around py-2">
            <a href="{% url 'home' %}" class="d-flex flex-column align-items-center text-decoration-none text-muted"
                aria-current="page">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-camera-fill" viewBox="0 0 16 16">
                    <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0" />
                    <path
                        d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0" />
                </svg>
            </a>

            <!--<a href="/community" class="d-flex flex-column align-items-center text-decoration-none text-muted">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-square-quote-fill" viewBox="0 0 16 16">
            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.5a1 1 0 0 0-.8.4l-1.9 2.533a1 1 0 0 1-1.6 0L5.3 12.4a1 1 0 0 0-.8-.4H2a2 2 0 0 1-2-2zm7.194 2.766a1.7 1.7 0 0 0-.227-.272 1.5 1.5 0 0 0-.469-.324l-.008-.004A1.8 1.8 0 0 0 5.734 4C4.776 4 4 4.746 4 5.667c0 .92.776 1.666 1.734 1.666.343 0 .662-.095.931-.26-.137.389-.39.804-.81 1.22a.405.405 0 0 0 .011.59c.173.16.447.155.614-.01 1.334-1.329 1.37-2.758.941-3.706a2.5 2.5 0 0 0-.227-.4zM11 7.073c-.136.389-.39.804-.81 1.22a.405.405 0 0 0 .012.59c.172.16.446.155.613-.01 1.334-1.329 1.37-2.758.942-3.706a2.5 2.5 0 0 0-.228-.4 1.7 1.7 0 0 0-.227-.273 1.5 1.5 0 0 0-.469-.324l-.008-.004A1.8 1.8 0 0 0 10.07 4c-.957 0-1.734.746-1.734 1.667 0 .92.777 1.666 1.734 1.666.343 0 .662-.095.931-.26"/>
          </svg>
        </a>-->

            <a href="{% url 'chatbot' %}" class="d-flex flex-column align-items-center text-decoration-none text-muted">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="mb-1"
                    viewBox="0 0 16 16">
                    <path d="M2 2h12v9H5.414L3 13.414V2z" />
                </svg>
            </a>

            <a href="{% url 'pharmacy' %}" class="d-flex flex-column align-items-center text-decoration-none text-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-capsule-pill" viewBox="0 0 16 16">
                    <path
                        d="M11.02 5.364a3 3 0 0 0-4.242-4.243L1.121 6.778a3 3 0 1 0 4.243 4.243l5.657-5.657Zm-6.413-.657 2.878-2.879a2 2 0 1 1 2.829 2.829L7.435 7.536zM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8m-.5 1.042a3 3 0 0 0 0 5.917zm1 5.917a3 3 0 0 0 0-5.917z" />
                </svg>
            </a>

            <a href="tel:115" class="d-flex flex-column align-items-center text-decoration-none text-danger">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="mb-1"
                    viewBox="0 0 16 16">
                    <path
                        d="M3.654 1.328a.678.678 0 00-1.015-.063L1.605 2.298c-.483.48-.661 1.18-.45 1.803.35 1.098 1.07 2.78 2.65 4.36 1.58 1.58 3.262 2.3 4.36 2.65.623.211 1.323.033 1.803-.45l1.033-1.033a.678.678 0 00-.063-1.015l-2.07-1.552a.678.678 0 00-.58-.087l-1.52.507a.678.678 0 01-.657-.148L6.9 6.1a.678.678 0 00-.148-.657L6.255 4.9a.678.678 0 00-.087-.58L4.616 2.25z" />
                </svg>
                <!--<small class="d-block">G·ªçi c·∫•p c·ª©u</small>-->
            </a>

            <a href="{% url 'your_profile' %}" class="d-flex flex-column align-items-center text-decoration-none text-muted">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-person-circle" viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                    <path fill-rule="evenodd"
                        d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
                </svg>
            </a>
        </div>
    </nav>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Read auth flag (kept from home.html pattern)
        const IS_AUTHENTICATED = document.body && document.body.dataset ? document.body.dataset.auth === 'true' : false;

        let currentLat, currentLon;

        function haversine(lat1, lon1, lat2, lon2) {
            function toRad(x) { return x * Math.PI / 180; }
            const R = 6371000; // m
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        let map, userMarker, markersLayer;

        function initMap(lat, lon) {
            if (!map) {
                map = L.map('map').setView([lat, lon], 14);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19, attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);
                markersLayer = L.layerGroup().addTo(map);
            } else {
                map.setView([lat, lon], 14);
                markersLayer.clearLayers();
            }
            if (userMarker) {
                userMarker.setLatLng([lat, lon]);
            } else {
                // show user location as a styled circle marker
                userMarker = L.circleMarker([lat, lon], { radius: 6, color: '#0d6efd', fillColor: '#0d6efd', fillOpacity: 0.9 }).addTo(map).bindPopup('{% trans "B·∫°n ·ªü ƒë√¢y" %}').openPopup();
            }
        }

        async function fetchLocations(type, lat, lon, radius) {
            const amenity = type === 'pharmacy' ? 'pharmacy' : type === 'hospital' ? 'hospital' : 'clinic';
            const query = `
                [out:json][timeout:25];
                (
                  node["amenity"="${amenity}"](around:${radius},${lat},${lon});
                  way["amenity"="${amenity}"](around:${radius},${lat},${lon});
                  relation["amenity"="${amenity}"](around:${radius},${lat},${lon});
                );
                out center;
            `;
            try {
                const resp = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: 'data=' + encodeURIComponent(query)
                });
                const data = await resp.json();
                const items = (data.elements || []).map(el => {
                    let elLat = el.lat || (el.center && el.center.lat);
                    let elLon = el.lon || (el.center && el.center.lon);
                    return { id: el.id, lat: elLat, lon: elLon, tags: el.tags || {} };
                }).filter(it => it.lat && it.lon);
                // compute distances
                items.forEach(it => { it.dist = haversine(lat, lon, it.lat, it.lon); });
                items.sort((a, b) => a.dist - b.dist);
                return items;
            } catch (e) { console.error('Overpass failed', e); return []; }
        }

        function renderList(type, items) {
            const list = document.getElementById('list'); list.innerHTML = '';
            const defaultName = type === 'pharmacy' ? '{% trans "Nh√† thu·ªëc" %}' : type === 'hospital' ? '{% trans "B·ªánh vi·ªán" %}' : '{% trans "Ph√≤ng kh√°m" %}';
            items.forEach((it, idx) => {
                const name = it.tags.name || defaultName;
                const addr = [it.tags['addr:street'], it.tags['addr:city']].filter(Boolean).join(', ');
                const li = document.createElement('a');
                li.className = 'list-group-item list-group-item-action pharmacy-item';
                li.innerHTML = `<div class="d-flex justify-content-between"><div><strong>${name}</strong><div class="small text-muted">${addr}</div></div><div class="text-end small">${(it.dist / 1000).toFixed(2)} km</div></div>`;
                li.href = '#';
                li.addEventListener('click', (ev) => { ev.preventDefault(); map.setView([it.lat, it.lon], 17); });
                list.appendChild(li);
            });
        }

        function placeMarkers(type, items) {
            markersLayer.clearLayers();
            const defaultName = type === 'pharmacy' ? 'Nh√† thu·ªëc' : type === 'hospital' ? 'B·ªánh vi·ªán' : 'Ph√≤ng kh√°m';
            items.forEach(it => {
                const name = it.tags.name || defaultName;
                const popup = `<div><strong>${name}</strong><div class="small text-muted">${it.tags.operator || ''}</div><div class="small">${(it.dist / 1000).toFixed(2)} km</div></div>`;
                const m = L.marker([it.lat, it.lon]).bindPopup(popup);
                markersLayer.addLayer(m);
            });
        }

        function updateTitles(type) {
            const listTitles = {
                'pharmacy': '{% trans "Nh√† thu·ªëc g·∫ßn ƒë√¢y" %}',
                'hospital': '{% trans "B·ªánh vi·ªán g·∫ßn ƒë√¢y" %}',
                'clinic': '{% trans "Ph√≤ng kh√°m g·∫ßn ƒë√¢y" %}'
            };
            document.getElementById('listTitle').textContent = listTitles[type] || '{% trans "C∆° s·ªü y t·∫ø g·∫ßn ƒë√¢y" %}';

            const mainHints = {
                'pharmacy': 'T√¨m nh√† thu·ªëc g·∫ßn v·ªã tr√≠ c·ªßa b·∫°n',
                'pharmacy': '{% trans "T√¨m nh√† thu·ªëc g·∫ßn v·ªã tr√≠ c·ªßa b·∫°n" %}',
                'hospital': '{% trans "T√¨m b·ªánh vi·ªán g·∫ßn v·ªã tr√≠ c·ªßa b·∫°n" %}',
                'clinic': '{% trans "T√¨m ph√≤ng kh√°m g·∫ßn v·ªã tr√≠ c·ªßa b·∫°n" %}'
            };
        document.getElementById('mainHint').textContent = mainHints[type] || '{% trans "T√¨m c∆° s·ªü y t·∫ø g·∫ßn v·ªã tr√≠ c·ªßa b·∫°n" %}';

        const pageTitles = {
            'pharmacy': '{% trans "Nh√† thu·ªëc g·∫ßn t√¥i - DermAI" %}',
            'hospital': '{% trans "B·ªánh vi·ªán g·∫ßn t√¥i - DermAI" %}',
            'clinic': '{% trans "Ph√≤ng kh√°m g·∫ßn t√¥i - DermAI" %}'
        };
        document.title = pageTitles[type] || '{% trans "C∆° s·ªü y t·∫ø g·∫ßn t√¥i - DermAI" %}';
        }

        async function tryLocateAndShow() {
            function onFound(lat, lon) {
                currentLat = lat;
                currentLon = lon;
                initMap(lat, lon);
                const type = document.getElementById('typeSelect').value || 'pharmacy';
                const radius = parseInt(document.getElementById('radiusSelect').value || '5000', 10);
                fetchLocations(type, lat, lon, radius).then(items => {
                    renderList(type, items);
                    placeMarkers(type, items);
                    updateTitles(type);
                });
            }

            // Try navigator.geolocation first
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async pos => {
                    onFound(pos.coords.latitude, pos.coords.longitude);
                }, async err => {
                    console.warn('Geolocation denied/fail:', err);
                    // fallback to IP-based lookup
                    try {
                        const r = await fetch('https://ipapi.co/json/');
                        const ipdata = await r.json();
                        if (ipdata && ipdata.latitude && ipdata.longitude) {
                            onFound(parseFloat(ipdata.latitude), parseFloat(ipdata.longitude));
                        } else {
                            // show an empty map (center Vietnam) and message
                            initMap(21.028511, 105.804817); // Hanoi center fallback
                            document.getElementById('list').innerHTML = '<div class="text-muted">{% trans "Kh√¥ng th·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠. H√£y nh·∫≠p ƒë·ªãa ch·ªâ th·ªß c√¥ng." %}</div>';
                            const type = document.getElementById('typeSelect').value || 'pharmacy';
                            updateTitles(type);
                        }
                    } catch (e) {
                        console.error('IP geolocation failed', e);
                        initMap(21.028511, 105.804817);
                        document.getElementById('list').innerHTML = '<div class="text-muted">{% trans "Kh√¥ng th·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠. H√£y nh·∫≠p ƒë·ªãa ch·ªâ th·ªß c√¥ng." %}</div>';
                        const type = document.getElementById('typeSelect').value || 'pharmacy';
                        updateTitles(type);
                    }
                }, { enableHighAccuracy: true, timeout: 8000 });
            } else {
                // no geolocation API
                try {
                    const r = await fetch('https://ipapi.co/json/');
                    const ipdata = await r.json();
                    if (ipdata && ipdata.latitude && ipdata.longitude) { onFound(parseFloat(ipdata.latitude), parseFloat(ipdata.longitude)); }
                } catch (e) {
                    initMap(21.028511, 105.804817);
                    document.getElementById('list').innerHTML = '<div class="text-muted">Kh√¥ng th·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠. H√£y nh·∫≠p ƒë·ªãa ch·ªâ th·ªß c√¥ng.</div>';
                    const type = document.getElementById('typeSelect').value || 'pharmacy';
                    updateTitles(type);
                }
            }
        }

        // Hook up search button (Nominatim geocoding)
        document.addEventListener('DOMContentLoaded', () => {
            // Type select change listener
            document.getElementById('typeSelect').addEventListener('change', async (ev) => {
                const type = ev.target.value;
                if (currentLat && currentLon) {
                    const radius = parseInt(document.getElementById('radiusSelect').value || '5000', 10);
                    try {
                        const items = await fetchLocations(type, currentLat, currentLon, radius);
                        renderList(type, items);
                        placeMarkers(type, items);
                        updateTitles(type);
                    } catch (e) {
                        console.error('Refetch on type change failed', e);
                    }
                }
            });

            document.getElementById('searchBtn').addEventListener('click', async () => {
                const q = document.getElementById('locationSearch').value.trim();
                if (!q) return tryLocateAndShow();
                try {
                    const resp = await fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(q));
                    const results = await resp.json();
                    if (results && results[0]) {
                        const lat = parseFloat(results[0].lat), lon = parseFloat(results[0].lon);
                        currentLat = lat;
                        currentLon = lon;
                        initMap(lat, lon);
                        const type = document.getElementById('typeSelect').value || 'pharmacy';
                        const radius = parseInt(document.getElementById('radiusSelect').value || '5000', 10);
                        const items = await fetchLocations(type, lat, lon, radius);
                        renderList(type, items); placeMarkers(type, items);
                        updateTitles(type);
                    } else {
                        alert('{% trans "Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm, th·ª≠ nh·∫≠p c·ª• th·ªÉ h∆°n." %}');
                    }
                } catch (e) { console.error(e); alert('{% trans "L·ªói khi t√¨m ƒë·ªãa ƒëi·ªÉm." %}'); }
            });

            // initial attempt to locate
            tryLocateAndShow();
            updateTitles(document.getElementById('typeSelect').value || 'pharmacy');
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function switchLanguage(langCode) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/i18n/setlang/';
            const csrfToken = document.cookie.split('; ').find(row => row.startsWith('csrftoken='))?.split('=')[1];
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = csrfToken || '';
            const langInput = document.createElement('input');
            langInput.type = 'hidden';
            langInput.name = 'language';
            langInput.value = langCode;
            const nextInput = document.createElement('input');
            nextInput.type = 'hidden';
            nextInput.name = 'next';
            nextInput.value = window.location.pathname;
            form.appendChild(csrfInput);
            form.appendChild(langInput);
            form.appendChild(nextInput);
            document.body.appendChild(form);
            form.submit();
        }
    </script>
</body>

</html>